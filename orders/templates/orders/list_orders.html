
<div class="col-md-12">
    <div class="bg-white p-4 mb-4 mx-2 rounded custom-shadow">
        <h3 class="text-center mb-4">Мои заказы</h3>
        {% if not orders %}
            <div class="alert alert-info text-center">
                У вас пока нет оформленных заказов.
            </div>
        {% else %}
            <div class="accordion" id="ordersAccordion">
                {% for order in orders %}
                <div class="accordion-item border rounded mb-3">
                    <h2 class="accordion-header" id="heading{{ order.id }}">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                data-bs-target="#collapse{{ order.id }}" aria-expanded="false" 
                                aria-controls="collapse{{ order.id }}">
                            <div class="d-flex flex-wrap justify-content-between w-100">
                                <div class="order-info me-3">
                                    <h5 class="mb-1 d-inline-block">Заказ №{{ order.id }}</h5>
                                    <small class="text-muted ms-2">{{ order.created_timestamp|date:"d.m.Y H:i" }}</small>
                                </div>
                                <div class="order-status">
                                    <span class="badge 
                                        {% if order.status == 'В обработке' %}bg-primary
                                        {% elif order.status == 'Отправлен' %}bg-info
                                        {% elif order.status == 'Доставлен' %}bg-success
                                        {% elif order.status == 'Отменен' %}bg-danger
                                        {% else %}bg-secondary{% endif %}">
                                        {{ order.status }}
                                    </span>
                                </div>
                            </div>
                        </button>
                    </h2>
                    <div id="collapse{{ order.id }}" class="accordion-collapse collapse" 
                        aria-labelledby="heading{{ order.id }}" data-bs-parent="#ordersAccordion">
                        <div class="accordion-body p-0">
                            <div class="order-details">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <!-- Таблица с товарами -->
                                        <thead class="table-light">
                                            <tr>
                                                <th>Товар</th>
                                                <th class="text-center">Кол-во</th>
                                                <th class="text-end">Цена</th>
                                                <th class="text-end">Сумма</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for item in order.orderitem_set.all %}
                                            <tr>
                                                <td>
                                                    <a href="{% url 'goods:product' item.product.slug %}" class="text-decoration-none">
                                                        <div class="d-flex align-items-center">
                                                            {% if item.product.image %}
                                                            <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="img-fluid rounded me-2" width="50">
                                                            {% endif %}
                                                            <div>
                                                                <div class="fw-bold">{{ item.product.name }}</div>
                                                                <small class="text-muted">{{ item.product.description|truncatechars:30 }}</small>
                                                            </div>
                                                        </div>
                                                    </a>
                                                </td>
                                                <td class="text-center">{{ item.quantity }}</td>
                                                <td class="text-end">{{ item.price }} ₽</td>
                                                <td class="text-end">{{ item.product_price }} ₽</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                        <tfoot class="table-light">
                                            <tr>
                                                <td colspan="3" class="fw-bold text-end">Итого:</td>
                                                <td class="fw-bold text-end">{{ order.total_price }} ₽</td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                                
                                <div class="order-footer p-3 bg-light d-flex justify-content-between align-items-center">
                                    <div class="delivery-info">
                                        <small class="text-muted">
                                            <i class="bi bi-truck me-1"></i>
                                            {% if order.requires_delivery %}
                                                Доставка: {{ order.delivery_address }}
                                            {% else %}
                                                Самовывоз
                                            {% endif %}
                                        </small>
                                    </div>
                                    <div class="payment-method">
                                        <small class="text-muted">
                                            <i class="bi bi-credit-card me-1"></i>
                                            {% if order.payment_on_get %}
                                                Оплата при получении
                                            {% else %}
                                                Онлайн оплата
                                            {% endif %}
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
</div>