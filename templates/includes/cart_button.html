{% load static %}
{% load carts_tags %}

{% user_carts request as carts %}

<!-- Кнопка корзины -->
<div class="cart-floating-btn">
    <button type="button" class="btn btn-primary btn-cart" data-bs-toggle="modal" data-bs-target="#cartModal">
        <i class="bi bi-cart3"></i>
        <span class="cart-badge" id="goods-in-cart-count">{{ carts.total_quantity }}</span>
    </button>
</div>

<!-- Модальное окно -->
<div class="modal fade" id="cartModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h5 class="modal-title">
                    <i class="bi bi-cart-fill me-2"></i>
                    Ваша корзина
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="cart-items-container">
                    {% include "carts/includes/included_cart.html" %}
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-chevron-left me-1"></i> Продолжить покупки
                </button>
                {% if carts and not order %}
                <a href="{% url 'orders:create_order' %}" class="btn btn-success">
                    Оформить заказ <i class="bi bi-chevron-right ms-1"></i>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
    /* Стили для кнопки корзины */
    .cart-floating-btn {
        position: fixed;
        bottom: 30px;
        right: 30px;
        z-index: 1000;
    }
    
    .btn-cart {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        position: relative;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    
    .btn-cart i {
        font-size: 1.5rem;
    }
    
    .cart-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #ff4757;
        color: white;
        border-radius: 50%;
        width: 25px;
        height: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
    }
    
    /* Анимация открытия модального окна */
    .modal.fade .modal-dialog {
        transition: transform 0.3s ease-out;
        transform: translate(0, 50px);
    }
    
    .modal.show .modal-dialog {
        transform: none;
    }
</style>